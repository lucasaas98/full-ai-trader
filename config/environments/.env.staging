# Staging Environment Configuration
# This file contains configuration for the staging environment
# Used for pre-production testing and validation

# =============================================================================
# ENVIRONMENT SETTINGS
# =============================================================================
ENVIRONMENT=staging
DEBUG=false
LOG_LEVEL=INFO
TESTING=false

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
DB_HOST=postgres
DB_PORT=5432
DB_NAME=trading_system_staging
DB_USER=trader_staging
DB_PASSWORD=${DB_PASSWORD_STAGING}
DB_POOL_SIZE=15
DB_MAX_OVERFLOW=25
DB_ECHO=false

# Database URLs
DATABASE_URL=postgresql://trader_staging:${DB_PASSWORD_STAGING}@postgres:5432/trading_system_staging
TEST_DATABASE_URL=postgresql://trader_staging:${DB_PASSWORD_STAGING}@postgres:5432/trading_system_staging_test

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD_STAGING}
REDIS_DB=0
REDIS_POOL_SIZE=15
REDIS_SOCKET_TIMEOUT=5
REDIS_CONNECTION_TIMEOUT=10

# Redis URLs
REDIS_URL=redis://:${REDIS_PASSWORD_STAGING}@redis:6379/0
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD_STAGING}@redis:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD_STAGING}@redis:6379/2

# =============================================================================
# API KEYS AND EXTERNAL SERVICES
# =============================================================================
# Trading APIs (Paper trading for staging)
ALPACA_API_KEY=${ALPACA_API_KEY_STAGING}
ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY_STAGING}
ALPACA_BASE_URL=https://paper-api.alpaca.markets
ALPACA_DATA_URL=https://data.alpaca.markets

# Market Data APIs
TWELVE_DATA_API_KEY=${TWELVE_DATA_API_KEY_STAGING}
FINVIZ_API_KEY=${FINVIZ_API_KEY_STAGING}

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
# JWT Configuration
JWT_SECRET_KEY=${JWT_SECRET_KEY_STAGING}
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Encryption keys
ENCRYPTION_KEY=${ENCRYPTION_KEY_STAGING}
BACKUP_ENCRYPTION_KEY=${BACKUP_ENCRYPTION_KEY_STAGING}
EXPORT_ENCRYPTION_KEY=${EXPORT_ENCRYPTION_KEY_STAGING}

# API Rate Limiting (More restrictive than dev)
RATE_LIMIT_REQUESTS=200
RATE_LIMIT_WINDOW=60
RATE_LIMIT_BURST=20

# =============================================================================
# TRADING CONFIGURATION
# =============================================================================
# Risk Management (Conservative for staging)
RISK_MAX_POSITION_SIZE=0.03
RISK_MAX_PORTFOLIO_RISK=0.02
RISK_DRAWDOWN_LIMIT=0.10
RISK_VAR_CONFIDENCE=0.99
RISK_CORRELATION_THRESHOLD=0.6

# Trading Settings
TRADING_DRY_RUN=true
TRADING_PAPER_MODE=true
TRADING_MAX_ORDERS_PER_DAY=20
TRADING_MIN_ORDER_VALUE=100
TRADING_MAX_ORDER_VALUE=5000

# Strategy Parameters
STRATEGY_LOOKBACK_DAYS=60
STRATEGY_REBALANCE_FREQUENCY=daily
STRATEGY_MIN_CONFIDENCE=0.7

# =============================================================================
# SCHEDULER CONFIGURATION
# =============================================================================
SCHEDULER_MARKET_DATA_INTERVAL=60
SCHEDULER_STRATEGY_INTERVAL=300
SCHEDULER_RISK_CHECK_INTERVAL=60
SCHEDULER_PORTFOLIO_UPDATE_INTERVAL=120
SCHEDULER_BACKUP_INTERVAL=43200
SCHEDULER_CLEANUP_INTERVAL=3600

# Market Hours (Eastern Time)
MARKET_OPEN_HOUR=9
MARKET_OPEN_MINUTE=30
MARKET_CLOSE_HOUR=16
MARKET_CLOSE_MINUTE=0

# =============================================================================
# MONITORING AND ALERTING
# =============================================================================
# Prometheus
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_DAYS=15

# Grafana
GRAFANA_USER=admin
GRAFANA_PASSWORD=${GRAFANA_PASSWORD_STAGING}
GRAFANA_ROOT_URL=https://staging-grafana.trading-system.com

# Alerting
GOTIFY_URL=${GOTIFY_URL_STAGING}
GOTIFY_TOKEN=${GOTIFY_TOKEN_STAGING}
SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL_STAGING}
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=${EMAIL_USERNAME_STAGING}
EMAIL_PASSWORD=${EMAIL_PASSWORD_STAGING}
ALERT_EMAIL_TO=${ALERT_EMAIL_STAGING}


# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_SCHEDULE=0 */6 * * *
BACKUP_RETENTION_DAYS=14
BACKUP_COMPRESSION=gzip
BACKUP_ENCRYPTION_ENABLED=true

# Backup paths
BACKUP_ROOT=/app/backups
DATA_ROOT=/app/data
LOG_ROOT=/app/logs

# Cloud backup
S3_BACKUP_BUCKET=trading-system-staging-backups
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID_STAGING}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY_STAGING}
AWS_REGION=us-east-1

# =============================================================================
# EXPORT CONFIGURATION
# =============================================================================
EXPORT_FORMAT=json,csv,parquet
EXPORT_COMPRESSION=gzip
EXPORT_RETENTION_DAYS=30
TRADENOTE_EXPORT_ENABLED=true
EXPORT_BATCH_SIZE=1000

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_FORMAT=structured
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/app/logs/trading_system.log
LOG_FILE_MAX_SIZE=100MB
LOG_FILE_BACKUP_COUNT=10

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_PATH=/app/logs/audit.log
AUDIT_LOG_RETENTION_DAYS=90

# Centralized logging
ELASTICSEARCH_HOST=elasticsearch
ELASTICSEARCH_PORT=9200
LOGSTASH_HOST=logstash
LOGSTASH_PORT=5044

# =============================================================================
# SERVICE PORTS
# =============================================================================
DATA_COLLECTOR_PORT=8001
STRATEGY_ENGINE_PORT=8002
RISK_MANAGER_PORT=8003
TRADE_EXECUTOR_PORT=8004
SCHEDULER_PORT=8005
EXPORT_SERVICE_PORT=8006
MAINTENANCE_SERVICE_PORT=8007

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
# Worker processes (Optimized for staging resources)
WORKER_PROCESSES=3
WORKER_THREADS=6
WORKER_TIMEOUT=60

# Connection pools
DB_POOL_SIZE=15
DB_MAX_OVERFLOW=25
REDIS_POOL_SIZE=15

# Cache settings
CACHE_TTL=600
CACHE_MAX_SIZE=5000

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_BACKTESTING=true
FEATURE_PAPER_TRADING=true
FEATURE_LIVE_TRADING=false
FEATURE_AI_STRATEGIES=true
FEATURE_SOCIAL_SENTIMENT=true
FEATURE_OPTIONS_TRADING=false
FEATURE_CRYPTO_TRADING=false

# =============================================================================
# STAGING SPECIFIC SETTINGS
# =============================================================================
# Data refresh settings
DATA_REFRESH_ON_STARTUP=true
SEED_TEST_DATA=true
RESET_DB_ON_DEPLOY=false

# Performance testing
LOAD_TEST_ENABLED=false
STRESS_TEST_ENABLED=false

# Integration testing
EXTERNAL_API_TESTING=true
END_TO_END_TESTING=true

# =============================================================================
# MAINTENANCE SETTINGS
# =============================================================================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=Staging environment under maintenance
MAINTENANCE_BYPASS_TOKEN=${MAINTENANCE_BYPASS_TOKEN_STAGING}

# Graceful shutdown timeout
SHUTDOWN_TIMEOUT=60

# Health check intervals
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_START_PERIOD=60

# =============================================================================
# DATA PATHS
# =============================================================================
DATA_PARQUET_PATH=/app/data/parquet
DATA_LOGS_PATH=/app/data/logs
DATA_EXPORTS_PATH=/app/data/exports
DATA_BACKUPS_PATH=/app/data/backups
DATA_TEMP_PATH=/app/data/temp

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================
IMAGE_TAG=staging
COMPOSE_PROJECT_NAME=trading_system_staging
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
# API Gateway
API_GATEWAY_HOST=nginx
API_GATEWAY_PORT=80
API_GATEWAY_TIMEOUT=30

# Load balancing
LOAD_BALANCER_ALGORITHM=round_robin
LOAD_BALANCER_HEALTH_CHECK=true

# =============================================================================
# NOTIFICATION SETTINGS
# =============================================================================
NOTIFICATIONS_ENABLED=true
NOTIFICATION_CHANNELS=slack,email,gotify
NOTIFICATION_LEVEL=WARNING

# Staging notification thresholds
ALERT_ERROR_THRESHOLD=5
ALERT_WARNING_THRESHOLD=20
ALERT_CPU_THRESHOLD=80
ALERT_MEMORY_THRESHOLD=85
ALERT_DISK_THRESHOLD=90

# =============================================================================
# COMPLIANCE AND AUDIT
# =============================================================================
COMPLIANCE_MODE=enabled
AUDIT_ALL_TRADES=true
AUDIT_API_CALLS=true
AUDIT_USER_ACTIONS=true
AUDIT_SYSTEM_CHANGES=true

# Regulatory settings
REGULATORY_REPORTING=true
TRADE_REPORTING_ENABLED=true
POSITION_REPORTING_ENABLED=true

# =============================================================================
# DEPLOYMENT SETTINGS
# =============================================================================
DEPLOYMENT_STRATEGY=blue_green
HEALTH_CHECK_GRACE_PERIOD=60
ROLLBACK_ON_FAILURE=true
AUTO_SCALE_ENABLED=false

# Container resource limits (staging environment)
MAX_MEMORY_PER_SERVICE=2G
MAX_CPU_PER_SERVICE=1.0
